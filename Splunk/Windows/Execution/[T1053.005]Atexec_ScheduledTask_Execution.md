# [T1053.005] Atexec ScheduledTask Execution

### Mitre Tactic:  
*Execution*

#### Description:  
Detects the use of `atexec.py`, an Impacket tool that executes commands on remote systems by creating and deleting a **Scheduled Task** with a random 8-character mixed-case name. It runs `cmd.exe /C <command> > C:\Windows\Temp\xxxxxxxx.tmp 2>&1` and then deletes the `.tmp` file after execution. The task is short-lived and stealthy, not detected by Windows Defender by default.

This rule attempts to identify this pattern using a combination of scheduled task creation logs, command-line artifacts, and temporary `.tmp` file creation in `C:\Windows\Temp`.

```bash
(
  index=wineventlog EventCode=4698
  AND TaskName LIKE "???????"
  AND Image="*\\cmd.exe"
  AND CommandLine LIKE "%C:\\Windows\\Temp\\%.tmp%"
)
OR
(
  index=sysmon EventCode=1
  AND CommandLine LIKE "%cmd.exe /C%" 
  AND CommandLine LIKE "%C:\\Windows\\Temp\\%.tmp%"
)
OR
(
  index=sysmon EventCode=11
  AND TargetFilename LIKE "C:\\Windows\\Temp\\????????.tmp"
)
| table _time, EventCode, Image, CommandLine, TaskName, TargetFilename, User, ComputerName
| sort _time desc
```