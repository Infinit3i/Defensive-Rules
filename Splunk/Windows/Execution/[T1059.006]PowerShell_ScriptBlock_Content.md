# [T1059.006] PowerShell_ScriptBlock_Content

### Mitre Tactic:  
*Execution*

---

#### Description:  
Detects suspicious PowerShell execution using script‐block content such as AMSI bypasses, Base64‐encoded payloads, Invoke-Obfuscation usage, or direct download invocations. Correlates Sysmon Event ID 1 (process creation) with PowerShell Operational Log Event ID 4104 (script block logging) to surface both command‐line and in‐memory script activity.

---

```bash
(
  index=sysmon EventCode=1 Image="*powershell.exe*" AND (
    CommandLine LIKE "%FromBase64String%" OR
    CommandLine LIKE "%amsi%" OR
    CommandLine LIKE "%IEX%" OR
    CommandLine LIKE "%Invoke-Obfuscation%" OR
    CommandLine LIKE "%DownloadString%"
  )
)
OR
(
  index=wineventlog EventCode=4104 Message="*powershell*" AND (
    Message LIKE "%FromBase64String%" OR
    Message LIKE "%amsi%" OR
    Message LIKE "%IEX%" OR
    Message LIKE "%Invoke-Obfuscation%" OR
    Message LIKE "%DownloadString%"
  )
)
| table _time, EventCode, Image, CommandLine, Message, ComputerName, ProcessId, ParentImage
| sort _time desc
```