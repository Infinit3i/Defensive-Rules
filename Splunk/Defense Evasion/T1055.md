# [T1055] Failed Priv Esc Attempts

### Mitre Tactic:  
*Defense Evasion*

#### Description:  
Detects failed attempts to escalate privileges using `sudo` or `su`. This includes authentication failures, or users not being in the sudoers file, which may indicate misconfigured scripts, insider attempts, or brute-force privilege escalation efforts.

```bash
index=syslog sourcetype="syslog" (
   ("sudo:" AND ("authentication failure" OR "not in the sudoers file"))
   OR
   ("su:" AND ("FAILED" OR "authentication failure"))
)
| table _time, host, Message
```

# [T1055] Process_Injection_Techniques_Splunk_Query

### Mitre Tactic:  
*Defense Evasion*

---

#### Description:  
Detects high-privilege handle requests or remote thread creation indicative of process injection. Monitors Sysmon Event ID 10 for access masks granting full or debug rights (e.g., `0x1F0FFF`, `0x1FFFFF`, `0x1410`, `0x143A`) and Event ID 8 for CreateRemoteThread events. Outputs source and target image paths, access masks, invoking user, and command line context to facilitate investigation of potential in-memory code injection.

---

```bash
index=sysmon (
    (EventCode=10 AND (
        GrantedAccess="*0x1F0FFF*" OR 
        GrantedAccess="*0x1FFFFF*" OR 
        GrantedAccess="*0x1410*" OR 
        GrantedAccess="*0x143A*"
    ))
    OR
    (EventCode=8)
)
| table _time, host, EventCode, SourceImage, TargetImage, GrantedAccess, User, CommandLine
```

# [T1055] Process Injection

### Mitre Tactic:  
*Defense Evasion*

---

#### Description:  
Detects suspicious process‐injection or handle‐access attempts against high‐value Windows processes (`lsass.exe`, `explorer.exe`). Monitors Sysmon Event ID 8 (CreateRemoteThread) and Event ID 10 (Process Access) where the target image is one of these processes, and correlates with Windows Security Event ID 4673/4674 events indicating privileged operations against them.

---

```bash
(
  (index=sysmon (EventCode=8 OR EventCode=10)
    AND TargetImage IN ("C:\\Windows\\System32\\lsass.exe", "C:\\Windows\\explorer.exe")
  )
  OR
  (index=wineventlog EventCode=4673 OR EventCode=4674
    AND Message="lsass.exe" OR Message="explorer.exe"
  )
)
| table _time, EventCode, Image, TargetImage, SourceProcessId, TargetProcessId, TargetProcessName, ProcessGuid, ComputerName, Message
| sort _time
```
