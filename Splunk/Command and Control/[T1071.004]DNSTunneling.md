# [T1071.004] DNS_Tunneling_Splunk_Query

### Mitre Tactic:  
*Command and Control*

---

#### Description:  
Detects potential DNS tunneling by identifying large volumes of DNS queries with suspicious patterns such as unusually long subdomains (over 50 characters), excessive lookup frequency, or multiple subdomain levels. Leverages Sysmon Event ID 22 (DNS Query) to surface candidate tunneling channels.

---

```bash
index=sysmon EventCode=22
| where QueryName LIKE "%.%" AND (strlen(QueryName) > 50 OR QueryName LIKE "%.%.%.%.%")
| stats count by QueryName, Image, User, ComputerName
| where count > 50
| sort -count
```