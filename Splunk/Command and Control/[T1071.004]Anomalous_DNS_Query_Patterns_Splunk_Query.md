
# [T1071.004] Application Layer Protocol: DNS

### Mitre Tactic:

*Command and Control*

#### Description:

Detects **advanced DNS tunneling or data exfiltration attempts** by flagging suspicious query patterns. Attackers often encode data within DNS queries to bypass network defenses. This rule looks for:

* Queries longer than 50 characters
* Queries containing long numeric strings (â‰¥6 digits)
* Queries with repeated subdomains of long alphanumeric strings

These patterns are strong indicators of DNS tunneling, data exfiltration, or beaconing activity.

```bash
index=zeek sourcetype="zeek:dns"
| eval query_length = len(query)
| where query_length > 50 OR match(query, "[0-9]{6,}") OR match(query, "([a-zA-Z0-9]{10,}\\.){3,}")
| stats count by query, id_orig_h, id_resp_h
| sort - count
| table query, id_orig_h, id_resp_h, count
```
