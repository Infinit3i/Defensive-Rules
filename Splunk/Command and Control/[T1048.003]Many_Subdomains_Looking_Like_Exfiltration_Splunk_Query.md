
# \[T1071.004] Application Layer Protocol: DNS

### Mitre Tactic:

*Command and Control*

#### Description:

Detects **high-volume, unique DNS queries** to the same root domain, a common indicator of DNS tunneling or data exfiltration. Adversaries often generate many unique subdomain queries under a single domain to encode and transmit data. This detection leverages Zeek DNS logs to count distinct queries per root domain and flags cases where more than 30 unique queries are observed from a single source host.

```bash
index=zeek sourcetype="zeek:dns"
| eval root_domain=replace(query, "^([^.]+\\.)+", "")
| stats dc(query) as unique_queries count by root_domain, id_orig_h
| where unique_queries > 30
| sort - unique_queries
| table _time, id_orig_h, root_domain, unique_queries, count
```
