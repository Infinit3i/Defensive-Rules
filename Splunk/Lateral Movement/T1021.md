# [T1021] External VPN Tunnel

### Mitre Tactic:  
*Lateral Movement*

#### Description:  
Detects IKE traffic (port 500) from external IP addresses. This may indicate VPN tunnel attempts or unauthorized IPsec-based connections. This rule filters out traffic from internal IP ranges (RFC1918) and focuses on port 500 activity either as source or destination.

```bash
index=syslog sourcetype=syslog
| where NOT cidrmatch("10.0.0.0/8", src_ip) AND NOT cidrmatch("192.168.0.0/16", src_ip) AND NOT cidrmatch("172.16.0.0/12", src_ip)
| where src_port=500 OR dest_port=500
```

```
index=zeek sourcetype="zeek:conn"
| where like(id.orig_h, "192.168.%") AND like(id.resp_h, "192.168.%") AND (service="rdp" OR service="winrm" OR service="dcerpc" OR service="msrpc")
| stats count by id.orig_h, id.resp_h, service
| sort - count
| table id.orig_h, id.resp_h, service, count
```

```
index=zeek sourcetype="zeek:conn"
| search service="smb" OR service="rdp" OR service="ssh" OR service="winrm"
| where like(id.orig_h, "192.168.%") AND like(id.resp_h, "192.168.%")
| stats count by id.orig_h, id.resp_h, service
| sort - count
| table id.orig_h, id.resp_h, service, count
```