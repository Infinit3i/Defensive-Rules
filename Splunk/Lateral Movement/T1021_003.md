# [T1021.003] Dcomexec Conhost Execution

### Mitre Tactic:  
*Lateral Movement*

#### Description:  
Detects `cmd.exe` spawning `conhost.exe` with the common Impacket `0xffffffff -ForceV1` argument chain. This follows command execution launched via `dcomexec.py`.

```bash
index=wineventlog EventCode=4688
| where Image="*\\conhost.exe" AND CommandLine LIKE "%0xffffffff%" AND CommandLine LIKE "%ForceV1%"
| table _time, host, SubjectUserName, Image, CommandLine, ParentImage
| sort _time desc
```

# [T1021.003] Dcomexec Logon Events

### Mitre Tactic:  
*Lateral Movement*

#### Description:  
Detects authentication artifacts generated by Impacket's `dcomexec.py` tool. Two rounds of logon events are observed, including credential validation (4776), privileged logon (4672), and interactive network logon (4624) using Logon Type 3.

```bash
index=wineventlog EventCode IN (4776, 4672, 4624) LogonType=3
| table _time, host, EventCode, SubjectUserName, TargetUserName, AuthenticationPackageName, LogonType, ComputerName
| sort _time desc
```

# [T1021.003] Dcomexec MMC Embedding

### Mitre Tactic:  
*Lateral Movement*

#### Description:  
Detects the use of `svchost.exe` spawning `mmc.exe -Embedding`, a known behavior of `dcomexec.py`. This activity is often missed by endpoint protection but logged by Windows Event ID 4688 (process creation).

```bash
index=wineventlog EventCode=4688
| where ParentImage="*\\svchost.exe" AND Image="*\\mmc.exe" AND CommandLine LIKE "%-Embedding%"
| table _time, host, SubjectUserName, Image, CommandLine, ParentImage
| sort _time desc
```

# [T1021.003] Dcomexec UNIX Epoch Output Redirect

### Mitre Tactic:  
*Lateral Movement*

#### Description:  
Detects output redirection to a path that includes the first 5 digits of the UNIX Epoch Time (e.g., `__sssss`) which is characteristic of `dcomexec.py`. This behavior is logged in Security Event ID 4688 where `mmc.exe` spawns `cmd.exe /Q /C`.

```bash
index=wineventlog EventCode=4688
| where Image="*\\cmd.exe" AND CommandLine LIKE "%127.0.0.1\\ADMIN$\\__%"
| table _time, host, SubjectUserName, Image, CommandLine, ParentImage
| sort _time desc
```